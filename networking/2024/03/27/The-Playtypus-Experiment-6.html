<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>The Playtypus Experiment #6 - PlaytypusGames</title>
<meta name="description" content="Touhma : First Post from Inno It’s his first time , don’t be gentle !">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="PlaytypusGames">
<meta property="og:title" content="The Playtypus Experiment #6">
<meta property="og:url" content="playtypusgames.github.io/networking/2024/03/27/The-Playtypus-Experiment-6.html">


  <meta property="og:description" content="Touhma : First Post from Inno It’s his first time , don’t be gentle !">







  <meta property="article:published_time" content="2024-03-27T10:00:00-04:00">






<link rel="canonical" href="playtypusgames.github.io/networking/2024/03/27/The-Playtypus-Experiment-6.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "playtypusgames.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="PlaytypusGames Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="https://playtypusgames.github.io/assets/Images/Playtypus-Temporary-Transparency.png" alt="PlaytypusGames"></a>
        
        <a class="site-title" href="/">
          PlaytypusGames
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="The Playtypus Experiment #6">
    <meta itemprop="description" content="  Touhma : First Post from Inno It’s his first time , don’t be gentle !">
    <meta itemprop="datePublished" content="2024-03-27T10:00:00-04:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">The Playtypus Experiment #6
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <blockquote>
  <p>Touhma : First Post from Inno It’s his first time , don’t be gentle !</p>
</blockquote>

<h2 id="coding-a-joke">Coding a joke</h2>

<blockquote>
  <p>Code is like humor. When you have to explain it, it’s bad. – Cory House</p>
</blockquote>

<p><em>cough cough</em></p>

<p>I have some explaining to do. ;)</p>

<p>I’ve spent the last forever working on implementing a lightweight RPC system.</p>

<p>For those of you with lives, RPC stands for Remote Procedure Call, for those with good lives: I’ve been developing a system so that a game server and game client can talk to each other XD</p>

<p>Now I know what you’re thinking -</p>

<blockquote>
  <p>Er… surely that’s a solved problem, why would you need to reinvent the wheel? Did you hit your head?</p>
</blockquote>

<p>Glad you telepathically asked! 
Of course it is!, I didn’t! and yes!</p>

<blockquote>
  <p>not confusing at all …</p>
</blockquote>

<p>Fortunately Unity even comes with its very own Netcode for Entities package, which has a lovingly crafted RPC system coded by experts that has all the bells and whistles a game developer could dream of. 
Unfortunately I don’t dream, and I’m not smart enough to understand how their system worked under the hood. 
I tried, and I think I got close, but in the end I decided it was easier to just write my own implementation ensuring that only the absolute minimum amount of data was wasted, and in as few clock cycles as possible without getting completely stupid. (I may have failed on the last part).</p>

<blockquote>
  <p>Touhma : Even the people at Unity &amp; a lot of devs confirmed us that Netcode is not made at all to support a factory building game &amp; we would be crazy not to use our own custom solution, so that was the right call, hopefully :)</p>
</blockquote>

<p>So that’s why I started writing Notwerk, my minimalist implementation of an RPC system for Unity ECS. No you can’t see it. But I can describe it to you! Oh, and if you care as much about esoteric behind the scenes ramblings by an unqualified amateur as I do about the latest Reality TV show, then I won’t blame you for scrolling to the bottom of this post, quickly glancing at it to make sure there isn’t anything worth looking at (there isn’t) and finding something better to do with your time.</p>

<h2 id="setting-up-the-playing-field">Setting up the playing field</h2>

<p>At the beginning here were the requirements :</p>

<p>Initial Goals:</p>
<ul>
  <li>Jam as much useful data through the series of tubes that is the internet as physically possible</li>
  <li>Ensure that the useful data actually gets where it’s going, and if it doesn’t, send it again until it does.</li>
  <li>Do it as quickly as possible.</li>
  <li>Make it easy to send and receive the data from our gamesystems.</li>
  <li>Leverage Source Generation to remove the requirement for ‘compilable portable function pointers’ because they sound scary.</li>
</ul>

<blockquote>
  <p>Touhma : Point of disagreement here but , whatever, we shall see in the future :D</p>
</blockquote>

<p>Stretch Goals added once I started:</p>
<ul>
  <li>Figure out how source generation works</li>
  <li>Hunt down the people responsible for Burst Compilation errors and pry the last two weeks from their cold…</li>
  <li>Calm down and eventually read the manual (I’m actually finally doing that now, as I write this. Damn. I could have saved 2 weeks…)</li>
</ul>

<h2 id="how-it-went">How it went</h2>

<p>I initially called it Notwerk because I didn’t think I’d ever get it working. But, we like it so it stuck.</p>

<p>I started with learning how to write a source generator, thinking that would be the hard part. 
I had a working example in 15 minutes. 
I was blown away by how incredibly awesome Roslyn Source Generation is, and decided I wanted to source generate as much as possible. 
So I did. I source generated so much stuff that I got way ahead of myself, and started implementing things that I wasn’t supposed to. 
It was fun though. A++ would use again.</p>

<blockquote>
  <p>Touhma : Technically the generator being a separated .dll from the game so it’s its own thing, could be hard to debug once it’s done but once it works , it works.</p>
</blockquote>

<p>The source generation involved has two or three parts, depending on whether the third part is useful or not.</p>
<ul>
  <li>Generate code that reads incoming bytestreams, and depending on the leading two bytes (The command ID), direct the bytestream to the correct Deserializer which turns it from an ordered stream of 0’s and 1’s into named Component Data that can be used by the game to do all manner of things.</li>
  <li>Generate code that turns Component Data into a stream of bytes that can be combined with other commands and sent across the network.</li>
</ul>

<p>Then it was just a matter of writing some extremely basic systems (In Unity ECS, the S stands for System, which is the logic code) that process the Components (The C in ECS) and do the actual sending.</p>

<p>That took about 50 hours, or roughly 10 lines of code (including whitespace, parentheses, and directives) per hour on average.</p>

<p>Of course, it was more than 500 lines at one point, but I’ve rewritten everything so many times I don’t remember a time when I wasn’t rewriting it.</p>

<p>I’m finally relatively happy with how it works, and now it’s time for Touhma to take a look and fire me.</p>

<blockquote>
  <p>Touhma : Sigh … I’m not employing you, you know ? I can’t fire you.</p>
</blockquote>

<p>In all actuality, I probably spent more time writing debug tools that allow logging bytestreams to console while remaining fully burst compiled than I did writing netcode, but without it I would still be wondering why things weren’t working (It turns out that if you press ctrl-d it duplicates the line you’re on, and I was reading a byte twice).</p>

<p>And now I have pretty colors in the console. Anyone who played GalacticScale2 with BepInEx console enabled would know how much I like console color.</p>

<p>I’ve spent 6 hours tonight getting it to a point where it <em>shouldn’t</em> be holding up Touhma’s Lockstep/GameTick/Prediction/Wizardry anymore.</p>

<blockquote>
  <p>Touhma : I’ll talk about that another time when I manage to get everything working as expected</p>
</blockquote>

<p>So I guess if you’re reading this it wasn’t the worst thing in the world.</p>

<blockquote>
  <p>Touhma : Getting there \o/</p>
</blockquote>

<p>Or I’m having an example made of me. Either way if anyone has any questions, feel free to ping me.</p>

<p>Until then, you can join <a href="https://discord.gg/sXrYTmXekC">Our Brand new Discord</a> to learn more about the project, chat, share ideas &amp; meet the dev team !</p>

<p>Take Care everyone !</p>

<p>Inno</p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-03-27T10:00:00-04:00">March 27, 2024</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/networking/2024/03/18/The-Playtypus-Experiment-5.html" class="pagination--pager" title="The Playtypus Experiment #5
">Previous</a>
    
    
      <a href="/networking/2024/04/13/The-Playtypus-Experiment-7.html" class="pagination--pager" title="The Playtypus Experiment #7
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 PlaytypusGames. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
